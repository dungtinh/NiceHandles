@model NiceHandles.Models.HoSo
@using NiceHandles.Models
@{
    var db = new NHModel();
    var service = db.Services.Find(Model.service_id);
    var lstCVIDS = db.fk_congviec_service.Where(x => x.service_id == service.id).Select(x => x.congviec_id);
    var lstCVs = lstCVIDS != null ? db.CongViecs.Where(x => lstCVIDS.Contains(x.id)) : null;
    var done = db.fk_congviec_hoso.Where(x => x.hoso_id == Model.id && x.status == (int)XModels.eStatus.Complete).Select(x => x.congviec_id);
}
<section id="ssCheckList" class="progressfile">
    <fieldset style="background-color: aliceblue;">
        <div class="progress_header">
            <div class="row" style="margin: 0;">
                <div class="col-sm-9 title">
                    <span class="fa fa-list"> Checklist việc phải làm: @service.name </span>
                </div>
                <div class="col-sm-3 tool">
                    <span style="font-size: 13px;">In checklist</span>
                    <a class="fa fa-print" onclick="InCongViec(@Model.id,@service.id);"></a>
                    <a onclick=""> <i class="fad fa-cogs"></i></a>
                    <a data-toggle="collapse" href="#ssCheckList .collapse" role="button" aria-expanded="false" aria-controls="#ssCheckList .collapse">
                        <i class="fa fa-angle-down" onclick="UpDownPanel(this)" style="padding-right: 10px;"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="progress_body collapse">
            <div style="padding: 3px 10px; margin-bottom: 10px;">
                <ul>
                    @foreach (var cate in XCongViec.sCategory)
                    {
                        <li style="list-style: none;">
                            <h5 style="text-transform: uppercase;" class="text-danger">@Html.Raw(XCongViec.sCategoryIcon[cate.Key]) @cate.Value </h5>
                            <ul>
                                @foreach (var cv in lstCVs.Where(x => x.category_id == cate.Key))
                                {
                                    <li style="list-style: none;">
                                        <input onclick="CVChange(this,@cv.id);" style="height: 20px; width: 20px;" type="checkbox" value="@cv.id" @Html.Raw(done.Contains(cv.id) ? "checked" : null) />
                                        <span style="vertical-align: super;">@cv.name</span>
                                    </li>
                                }
                            </ul>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </fieldset>
</section>