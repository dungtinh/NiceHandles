@model NiceHandles.Models.HoSo
@using NiceHandles.Models
@{
    ViewBag.Title = "Bản vẽ";
    var db = new NHModel();
    var progress = db.Progresses.FirstOrDefault(x => x.type == (int)XProgress.eType.BanVe);
    var passvalue = new xTemp() { int1 = Model.id, int2 = progress.type };
    var contract = db.Contracts.Find(Model.contract_id);
    var option = db.progress_file_option.FirstOrDefault(x => x.hoso_id == Model.id && x.progress_id == progress.id);
    if (option == null)
    {
        option = new progress_file_option() { hoso_id = Model.id, progress_id = progress.id };
        db.progress_file_option.Add(option);
        db.SaveChanges();
    }
    var files = db.progress_file.Where(x => x.hoso_id == Model.id && x.progress_id == progress.id);
    var dove = db.Doves.FirstOrDefault(x => x.hoso_id == Model.id);
}
<section id="ss@("_" + progress.type + Model.id)" class="progressfile">
    <fieldset>
        <div class="progress_header">
            <div class="row" style="margin: 0;">
                <div class="col-sm-4 title">
                    <span class="fa fa-map"> @progress.sort. @progress.title (@progress.phantram%)</span>
                </div>
                <div class="col-sm-5 desc">
                    <i>@progress.description</i>
                </div>
                <div class="col-sm-3 tool">
                    <label style="font-size: 14px;"><input type="checkbox" onchange="ProgressFileStatus(@Model.id, @progress.id,@progress.type, this);" @Html.Raw(option.status == (int)XModels.eLevel.Level1 ? "" : "checked") />  Hoàn thành</label>
                    <a onclick="ProgressDownload(@progress.id, @Model.id);"> <i class="fad fa-file-download"></i></a>
                    @*<i class="fad fa-print"></i>*@
                    <a onclick="ProgressSetting(@progress.id, @Model.id);"> <i class="fad fa-cogs" style="padding-right: 10px;"></i></a>
                    <a data-toggle="collapse" href="#ss@("_" + progress.type + Model.id) .collapse" role="button" aria-expanded="false" aria-controls="#ss@("_" + progress.type + Model.id) .collapse">
                        <i class="fa fa-angle-down" onclick="UpDownPanel(this)" style="padding-right: 10px;"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="progress_body collapse">
            <div class="row" style=" background-color: #f3e9e8;">
                <h4 style="text-align:center;">LIÊN HỆ PHÒNG ĐO VẼ</h4>
                <div class="col-md-12" id="phongdove">
                    @if (dove != null)
                    {
                        @Html.Partial("../Doves/NhatKyDoVe", new dovelichsu() { hoso_id = Model.id })
                    }
                    else
                    {
                        @Html.Partial("../Doves/Create", new dovelichsu() { hoso_id = Model.id })
                    }
                </div>
            </div>
            <div class="row">
                <div class="col-sm-2" style="text-align: right;">
                    Định vị thửa đất
                </div>
                <div class="col-md-7">
                    <input type="text" id="txtDinhViThuaDat" class="form-control" value="@Model.link_gmap" />
                </div>
                <div class="col-sm-3">
                    <button class="btn btn-info" onclick="LuuDinhViThuaDat(@Model.id,'#ss@("_" + progress.type + Model.id) #txtDinhViThuaDat');">Cập nhật</button>
                    <button class="btn btn-default " onclick="CopyText('#ss@("_" + progress.type + Model.id) #txtDinhViThuaDat');"><i class="fa fa-copy"></i></button>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-2" style="text-align: right;">
                    File AutoCad
                </div>
                <div class="col-md-7">
                    <input type="text" id="txtAutoCad" class="form-control" value="@Model.link_filecad" />
                </div>
                <div class="col-sm-3">
                    <button class="btn btn-info" onclick="LuuFileAutoCad(@Model.id,'#ss@("_" + progress.type + Model.id) #txtAutoCad');">Cập nhật</button>
                    <button class="btn btn-default" onclick="CopyText('#ss@("_" + progress.type + Model.id) #txtAutoCad');"><i class="fa fa-copy"></i></button>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-2" style="text-align: right;">
                    Ảnh Flycam
                </div>
                <div class="col-md-4">
                    <input type="file" class="btn btn-info txtFlycam" />
                </div>
                <div class="col-sm-2">
                    <input value="Upload" type="button" onclick="UploadProgressFile('#ss@("_" + progress.type + Model.id) .txtFlycam','#ss@("_" + progress.type + Model.id) .lstFlycam', @(Model.id) , @(progress.id) , @((int)XProgressFile.eType.Flycam) );" class="btn btn-info" />
                </div>
                <div class="col-sm-4 lstFlycam">
                    <ul style="margin:0; padding: 0; list-style: decimal;">
                        @foreach (var item in files.Where(x => x.type == (int)XProgressFile.eType.Flycam))
                        {
                            <li>
                                <a href="@item.url" target="_blank">@item.name</a>
                            </li>

                        }
                    </ul>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-2" style="text-align: right;">
                    Quy hoạch
                </div>
                <div class="col-md-4">
                    <input type="file" class="btn btn-info txtQuyHoach" />
                </div>
                <div class="col-sm-2">
                    <input value="Upload" type="button" onclick="UploadProgressFile('#ss@("_" + progress.type + Model.id) .txtQuyHoach','#ss@("_" + progress.type + Model.id) .lstQuyHoach', @(Model.id) , @(progress.id) , @((int)XProgressFile.eType.QuyHoach) );" class="btn btn-info" />
                </div>
                <div class="col-sm-4 lstQuyHoach">
                    <ul style="margin:0; padding: 0; list-style: decimal;">
                        @foreach (var item in files.Where(x => x.type == (int)XProgressFile.eType.QuyHoach))
                        {
                            <li>
                                <a href="@item.url" target="_blank">@item.name</a>
                            </li>
                        }
                    </ul>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-2" style="text-align: right;">
                    Mảnh trích đo
                </div>
                <div class="col-md-4">
                    <input type="file" class="btn btn-info txtManhTrichDo" />
                </div>
                <div class="col-sm-2">
                    <input value="Upload" type="button" onclick="UploadProgressFile('#ss@("_" + progress.type + Model.id) .txtManhTrichDo','#ss@("_" + progress.type + Model.id) .lstManhTrichDo', @(Model.id) , @(progress.id) , @((int)XProgressFile.eType.ManhTrichDo) );" class="btn btn-info" />
                </div>
                <div class="col-sm-4 lstManhTrichDo">
                    <ul style="margin:0; padding: 0; list-style: decimal;">
                        @foreach (var item in files.Where(x => x.type == (int)XProgressFile.eType.ManhTrichDo))
                        {
                            <li>
                                <a href="@item.url" target="_blank">@item.name</a>
                            </li>
                        }
                    </ul>
                </div>
            </div>
            @Html.Partial("../Progresses/ViecPhaiLam", passvalue)
            @Html.Partial("../Progresses/PartNhatKyNhacNho")
        </div>
    </fieldset>
</section>