
@model NiceHandles.Models.Contract
@using NiceHandles.Models
@{
    var db = new NHModel();
    var duchis = db.vDuChis.OrderBy(x => x.name).ToArray();
}

<h2>@Model.name</h2>
<h4><i> Các khoản trình duyệt chi trong hợp đồng</i></h4>
<hr />
<div class="row" id="duyetchi">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Người thực hiện</th>
                <th>Danh mục chi</th>
                <th>Công thực hiện</th>
                <th>Hành động</th>
                <th>Trạng thái</th>
                <th>Tiến độ</th>
                <th>Ghi chú</th>
                <th>Trả lại</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in duchis)
            {
                var temp = new xTemp() { int1 = item.category_id, int2 = Model.id, long1 = item.amount, str1 = item.name, int3 = item.id };
                @Html.Partial("_PartialTrinhDuChi", temp)
            }
        </tbody>
    </table>
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script type="text/javascript">
        $(document).ready(function () {
            $("#duyetchi :submit").click(function () {
                var id = this.id.replace("sub", "");
                $("#duyetchi #hdf" + id).val($("#duyetchi #amount" + id).autoNumeric('get') || 0);
                $("#duyetchi #hdfAcc" + id).val($("#duyetchi #acc" + id).val());
            });
        });
        function DiThucHien(id, status, note) {
            $.ajax({
                url: '/DuChis/DiThucHien',
                data: {
                    id: id,
                    status: status,
                    note: note
                },
                type: "POST",
                dataType: "JSON",
                success: function (nhatky) {
                    if (note) {
                        toastr.success("Đã lưu thành công", "Ghi chú thực hiện", { timeOut: 5000 });
                    } else {
                        document.location.reload();
                    }
                }
            });
        }
        function TraLaiDuChi(id) {
            $.ajax({
                url: '/DuChis/TraLaiDuChi',
                data: {
                    id: id
                },
                type: "POST",
                dataType: "JSON",
                success: function (obj) {
                    document.location.reload();
                }
            });
        }
    </script>
}
